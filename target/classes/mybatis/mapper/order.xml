<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nike.web.mapper.OrderMapper">

    <select id="selectProductByNo" resultType="orderItemDTO">
        SELECT DISTINCT P.PRO_NO,
                        P.PRO_NAME,
                        P.PRO_PRICE,
                        PQ.PRO_DISCOUNT
        FROM PRODUCT P
                 INNER JOIN PRODUCT_QTY PQ
                            ON P.PRO_NO = PQ.PRO_NO
        WHERE P.PRO_NO = #{productNo}
    </select>

    <insert id="insertOrder" parameterType="order">
        INSERT INTO ORDER_TB
            (ORDER_ID, MEMBER_NO, ORDER_NAME, ORDER_PHONE, ORDER_ADDR, ADDR_DETAIL, ORDER_AMOUNT, ORDER_PAYMENT, ORDER_DELIVERY, IMP_UID)
        VALUES
            (#{orderId}, #{memberNo}, #{orderName}, #{orderPhone}, #{orderAddr}, #{addrDetail}, #{orderAmount}, #{orderPayment}, #{orderDelivery}, #{impUid})
    </insert>

    <insert id="insertOrderDetail" parameterType="orderItemDTO">
        INSERT INTO ORDER_DETAIL
            (ORDER_ID, PRODUCT_NO, ORDER_QTY, ORDER_PRICE)
        VALUES
            (#{orderId}, #{productNo}, #{orderQty}, #{orderPrice})
    </insert>

    <select id="selectOrderByMemberNo" resultType="order">
        SELECT O.ORDER_ID,
               O.ORDER_DATE,
               P.PRO_NAME,
               OD.PRODUCT_SIZE,
               OD.ORDER_QTY,
               OD.ORDER_PRICE,
               O.ORDER_STATE,
               MAX(PI.PROIMG_NO) AS PROIMG_NO
        FROM ORDER_TB O
                 INNER JOIN ORDER_DETAIL OD ON O.ORDER_ID = OD.ORDER_ID
                 LEFT JOIN PRODUCT P ON OD.PRODUCT_NO = P.PRO_NO
                 LEFT JOIN PRODUCT_IMAGE PI ON P.PRO_NO = PI.PRO_NO
        WHERE O.MEMBER_NO = #{memberNo}
        GROUP BY ORDER_ID
    </select>

    <select id="selectProductDetailByOrderId" resultType="order">
        SELECT PI.PROIMG_NO,
               P.PRO_NAME,
               OD.PRODUCT_SIZE,
               OD.ORDER_QTY,
               OD.ORDER_PRICE,
               P.PRO_PRICE,
               PQ.PRO_DISCOUNT
        FROM ORDER_TB O
                 INNER JOIN ORDER_DETAIL OD ON O.ORDER_ID = OD.ORDER_ID
                 LEFT JOIN PRODUCT P ON OD.PRODUCT_NO = P.PRO_NO
                 LEFT JOIN PRODUCT_IMAGE PI ON P.PRO_NO = PI.PRO_NO
                 LEFT JOIN PRODUCT_QTY PQ ON PQ.PRO_NO = OD.PRODUCT_NO
        WHERE O.ORDER_ID = #{orderId}
    </select>

    <select id="selectInfoByOrderId" resultType="order">
        SELECT ORDER_ID,
               ORDER_DATE,
               ORDER_NAME,
               ORDER_STATE,
               ORDER_AMOUNT,
               ORDER_PAYMENT,
               ORDER_NAME,
               ORDER_POSTCODE,
               ORDER_ADDR,
               ORDER_PHONE,
               ORDER_MESSAGE
        FROM ORDER_TB
        WHERE ORDER_ID = #{orderId}
    </select>

</mapper>