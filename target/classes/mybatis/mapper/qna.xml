<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.nike.web.mapper.QnaMapper">
	
	<!-- 전체 레코드 갯수 -->
	<select id="selectQnaCount" resultType="Integer">
		SELECT COUNT(QNA_NO)
		  FROM QNA
	</select>

	<!-- 목록 -->
	<select id="selectQnaList" parameterType="Map" resultType="QnaDTO">
		SELECT *
		  FROM QNA
		 ORDER BY QNA_NO LIMIT #{beginRecord}, #{endRecord}
	</select>
	
	<!-- 원글 삽입 // (SELECT MAX(auto_increment 컬럼) FROM 테이블 S) +1 -->
	<insert id="insertQna" parameterType="QnaDTO">
		INSERT INTO QNA
			(QNA_TITLE, ID, QNA_CONTENT, QNA_DATE, QNA_STATE, QNA_DEPTH, QNA_GROUP_NO, QNA_GROUP_ORD)
		VALUES
			(#{qnaTitle}, #{id}, #{qnaContent}, NOW(), 1, 0, QNA_NO + 1, 0)
	</insert>
	
	<!-- 상세보기 -->
	<select id="selectQnaByNo" parameterType="Integer" resultType="QnaDTO">
		SELECT QNA_NO, ID, QNA_TITLE, QNA_CONTENT, QNA_DATE
		  FROM QNA
		 WHERE QNA_NO = #{qnaNo}
	</select>
	
	<update id="updatePreviousReply" parameterType="QnaDTO">
		UPDATE QNA
		   SET QNA_GROUP_ORD = QNA_GROUP_ORD + 1
		 WHERE QNA_GROUP_NO = #{qnaGroupNo}    
		   AND QNA_GROUP_ORD > 0
	</update>
	
	<!-- 댓글 삽입 (아이디 널값 수정해야함.test)-->
	<insert id="insertReply" parameterType="QnaDTO">
		INSERT INTO QNA
			(ID, QNA_CONTENT, QNA_DATE, QNA_STATE, QNA_DEPTH, QNA_GROUP_NO, QNA_GROUP_ORD)
		VALUES
			(null, #{qnaContent}, NOW(), 1, #{qnaDepth}, #{qnaGroupNo}, #{qnaGroupOrd})
	</insert>
	
	<!-- 삭제 -->
	<delete id="deleteQna" parameterType="Integer">
		UPDATE QNA
		   SET STATE = -1
		 WHERE QNA_NO = #{qnaNo}
	</delete>


</mapper>